<h4>Reported Issues</h4>

{% if issues %}
  <ul class="list-group">
    {% for issue in issues %}
      <li class="list-group-item mb-3">
        <strong>Appliance:</strong> {{ issue.appliance.name if issue.appliance else 'N/A' }} <br>
        <strong>Description:</strong> {{ issue.description }} <br>
        <strong>Status:</strong> {{ issue.status.capitalize() if issue.status else 'N/A' }} <br>
        <strong>Reported by:</strong> {{ issue.tenant.username if issue.tenant else 'N/A' }} <br>

        <strong>Vendor:</strong>
        {% if not issue.assigned_to %}
          <!-- Show dropdown to assign vendor if none assigned -->
          <form action="/manager/assign_vendor/{{ issue.id }}" method="post" class="mt-2 mb-2">
            <div class="input-group">
              <select name="worker" class="form-select" required>
                <option value="" disabled selected>Select Vendor</option>
                {% for vendor in vendors %}
                  <option value="{{ vendor.id }}">{{ vendor.name }} ({{ vendor.specialization }})</option>
                {% endfor %}
              </select>
              <button type="submit" class="btn btn-primary btn-sm">Assign</button>
            </div>
          </form>
        {% else %}
          {{ issue.vendor.name if issue.vendor else 'Not assigned' }}
        {% endif %}
        <br>

        <strong>Date Reported:</strong>
        {% if issue.created_at %}
          {{ issue.created_at.strftime('%Y-%m-%d %H:%M') }}
        {% else %}
          N/A
        {% endif %}
        <br>

        {% if issue.status.lower() == 'repaired' %}
          <strong>Bill:</strong> {{ issue.cost if issue.cost else 'N/A' }} <br>
          {% if issue.bill_url %}
            <strong>Bill File:</strong> <a href="{{ issue.bill_url }}" target="_blank">View</a> <br>
          {% endif %}
          <strong>Completed At:</strong>
          {% if issue.completed_at %}
            {{ issue.completed_at.strftime('%Y-%m-%d %H:%M') }}
          {% else %}
            N/A
          {% endif %}
        {% endif %}
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p>No issues reported.</p>
{% endif %}
